extends layout

block content
  head
    title Stripe Checkout Integration
    script(src='https://checkout.stripe.com/checkout.js')
  h2 Stripe Checkout
  #shop
    button#buttonCheckout Checkout
  script.
    var checkoutHandler = StripeCheckout.configure({
      key: "pk_test_5pvfMynil20Hgop2gjxxrAw90036Py8edd",
      locale: "auto"
    });

    var button = document.getElementById("buttonCheckout");
    button.addEventListener("click", function(ev) {
      checkoutHandler.open({
        name: "Sample Store",
        description: "Example Purchase",
        token: handleToken
      });
    });

    function handleToken(token) {
      fetch("/store/checkout", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(token)
      })
      .then(output => {
        if (output.status === "succeeded")
          document.getElementById("shop").innerHTML = "<p>Purchase complete!</p>";
      })
    }

    fetch("/store/checkout", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(token)
    })
    .then(response => {
      if (!response.ok)
        throw response;
      return response.json();
    })
    .then(output => {
      console.log("Purchase succeeded:", output);
    })
    .catch(err => {
      console.log("Purchase failed:", err);
    })