extends layout

block content
  if client
    h1 Edit Client
  else
    h1 Create Client
  br
  form.needs-validation(method='POST' action=(client ? '/users/edit' : '/users/create') id="form_registration" novalidate)
    .row
      .col
        label First Name:
        input.form-control(name='first_name' type='text' value=(client ? client.first_name : '') required maxlength='25')
      .col
        label Last Name:
        input.form-control(name='last_name' type='text' value=(client ? client.last_name : '') required maxlength='25')
    .row
      .col
        label Email:
        input.form-control(name='email' type='email', value=(client ? client.email : '') required maxlength='50') 
    br
    h2 Business Info
    .row
      .col 
        label Organization:
        input.form-control(name='organization' type='text' value=(client ? client.organization : '') required maxlength='25')
      .col 
        label Department:
        input.form-control(name='department' type='text' value=(client ? client.department : '') maxlength='25')
      .col 
        label Research Area:
        select.custom-select(name='research_area' id='research_area')
          option(value='' selected=(entry == null))
          option(value='cancer' selected=(client != null && client.research_area === 'cancer')) Cancer
          option(value='neuroscience' selected=(client != null && client.research_area === 'neuroscience')) Neuroscience
          option(value='stem_cell' selected=(client != null && client.research_area === 'stem_cell')) Stem Cell
          option(value='virology' selected=(client != null && client.research_area === 'virology')) Virology
          option(value='epigenetics' selected=(client != null && client.research_area === 'epigenetics')) Epigenetics
          option(value='cardiovascular_disease' selected=(client != null && client.research_area === 'cardiovascular_disease')) Cardiovascular Disease
    .row
      .col 
        label Address:
        textarea.form-control(rows="5" name="address" required) #{(client) ? client.address : ""}
    .form-row
      .col
        label City:
        input.form-control(name='city' type='text' value=(client ? client.city : '') maxlength='25' required)
        div.invalid-feedback We need to know where you live!
      .col-2
        label State:
        input.form-control(name='state' type='text' value=value=(client ? client.state : '') maxlength='2' required)
      .col-4
        label ZIP:
        input.form-control(name='zip' type='text' value=(client ? client.zip : '') pattern='[0-9]*' maxlength="5" required)
    .row 
      .col
        label Phone:
        input.form-control(name='phone' type='text' value=(client ? client.phone : '') pattern="^[1-9]{1}\\d{5}\\d{4}$" required='true')
        div.invalid-feedback Please enter a 10-digit phone number without any dashes or parentheses.
    .row 
      .col(id='po_num_col')
        label PO #:
        input.form-control(name='po_num' type='text' value=(client ? client.po_num : ''))  
    span(style="float: right; padding: 10px 0px 10px 0px;")
      input(type='hidden' name='id' value=(client ? client.id : ''))
      input.btn.btn-primary(type='submit' value=(client ? 'Update' : 'Create'))
    if client
      span(style="float: left; padding: 10px 0px 10px 0px;")
        button.btn.btn-danger.deleteButton(type="button" name="id" value=client.id data-toggle='modal' data-target='#DeleteModal') Delete
    
  .container
    #DeleteModal.modal.fade(tabindex="-1" role="dialog" aria-labelledby="DeleteModal" aria-hidden="true")
      .modal-dialog
        .modal-content
          .modal-header
            h5.modal-title Delete
            button.close(type="button" data-dismiss="modal" aria-hidden="true") &times;
          .modal-body
            p
              | Click &apos;Delete&apos; to 
              strong permanently
              |  delete this record. Click &apos;Cancel&apos; to cancel your action.
          .modal-footer
            button.btn.btn-secondary(type="button" data-dismiss="modal") Cancel
            button.btn.btn-danger.deleteModal(type="button" data-dismiss="modal" id="delete" value=1) Delete
  script.
    $('.deleteButton').on('click', function(e) {
      var itemId = $(e.target).attr('value');
      console.log(itemId);
      $(".deleteModal").val(itemId); 
    });

    $('.deleteModal').on('click', function(e){
      console.log('here');
      $target = $(e.target);
      $.ajax({
        type: 'POST',
        url: '/users/delete/'+$target.attr('value'),
        dataType: 'json',
        success: function(response){
          if (response.redirect !== undefined && response.redirect) {
            window.location.href = response.redirect;
          }
        }
      });
    }); 
  script(src='/js/formval.js')